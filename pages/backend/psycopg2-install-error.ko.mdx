---
title: xcode-select Failed to locate 'clang', requesting installation of command line developer tools
image: https://www.tabnine.com/academy/wp-content/uploads/2020/10/academy_1.png
description: "poetry로 psycopg2 패키지 도중 발생된 에러"
---

import Callout from 'nextra-theme-docs/callout'
import Bleed from 'nextra-theme-docs/bleed'
import { SiJavascript, SiPython } from 'react-icons/si'

# `psycopg2` 패키지 설치 에러

## 시도

poetry로 가상환경을 꾸리고 나서 Django와 PostgreSQL를 연동하기 위해 <a href="https://pypi.org/project/psycopg2/" target="_blank">psycopg2</a> 패키지를 설치하고자 했다.

<br/>

## 문제 발생

콘솔에 갑자기 긴 에러 메세지가 다음과 같이 나타났다.

```bash
> poetry add psycopg2
Using version ^2.9.3 for psycopg2

Updating dependencies
Resolving dependencies... (0.1s)

Package operations: 2 installs, 0 updates, 0 removals

  • Installing django-dotenv (1.4.2)
  • Installing psycopg2 (2.9.3): Failed

  CalledProcessError

  Command '['/Users/apensia/Library/Caches/pypoetry/virtualenvs/letsh-admin-zfYQThb9-py3.10/bin/python', '/Users/apensia/.local/pipx/venvs/poetry/lib/python3.10/site-packages/virtualenv/seed/wheels/embed/pip-22.2.2-py3-none-any.whl/pip', 'install', '--use-pep517', '--disable-pip-version-check', '--prefix', '/Users/apensia/Library/Caches/pypoetry/virtualenvs/letsh-admin-zfYQThb9-py3.10', '--no-deps', '/Users/apensia/Library/Caches/pypoetry/artifacts/53/f4/10/6c4fbf8671cd3e90cb0e036883b7aa9e49359e40fa11a699ffb31b2f2e/psycopg2-2.9.3.tar.gz']' returned non-zero exit status 1.

  at /opt/homebrew/Cellar/python@3.10/3.10.6_2/Frameworks/Python.framework/Versions/3.10/lib/python3.10/subprocess.py:524 in run
       520│             # We don't call process.wait() as .__exit__ does that for us.
       521│             raise
       522│         retcode = process.poll()
       523│         if check and retcode:
    →  524│             raise CalledProcessError(retcode, process.args,
       525│                                      output=stdout, stderr=stderr)
       526│     return CompletedProcess(process.args, retcode, stdout, stderr)
       527│
       528│

The following error occurred when trying to handle this error:


  EnvCommandError

  Command ['/Users/apensia/Library/Caches/pypoetry/virtualenvs/letsh-admin-zfYQThb9-py3.10/bin/python', '/Users/apensia/.local/pipx/venvs/poetry/lib/python3.10/site-packages/virtualenv/seed/wheels/embed/pip-22.2.2-py3-none-any.whl/pip', 'install', '--use-pep517', '--disable-pip-version-check', '--prefix', '/Users/apensia/Library/Caches/pypoetry/virtualenvs/letsh-admin-zfYQThb9-py3.10', '--no-deps', '/Users/apensia/Library/Caches/pypoetry/artifacts/53/f4/10/6c4fbf8671cd3e90cb0e036883b7aa9e49359e40fa11a699ffb31b2f2e/psycopg2-2.9.3.tar.gz'] errored with the following return code 1, and output:
  Processing /Users/apensia/Library/Caches/pypoetry/artifacts/53/f4/10/6c4fbf8671cd3e90cb0e036883b7aa9e49359e40fa11a699ffb31b2f2e/psycopg2-2.9.3.tar.gz
    Installing build dependencies: started
    Installing build dependencies: finished with status 'done'
    Getting requirements to build wheel: started
    Getting requirements to build wheel: finished with status 'done'
    Preparing metadata (pyproject.toml): started
    Preparing metadata (pyproject.toml): finished with status 'done'
  Building wheels for collected packages: psycopg2
    Building wheel for psycopg2 (pyproject.toml): started
    Building wheel for psycopg2 (pyproject.toml): finished with status 'error'
    error: subprocess-exited-with-error

    × Building wheel for psycopg2 (pyproject.toml) did not run successfully.
    │ exit code: 1
    ╰─> [77 lines of output]
        /private/var/folders/z_/h7g82ltn4px_w4m6d997tyqc0000gn/T/pip-build-env-jhthind1/overlay/lib/python3.10/site-packages/setuptools/config/setupcfg.py:508: SetuptoolsDeprecationWarning: The license_file parameter is deprecated, use license_files instead.
          warnings.warn(msg, warning_class)
        running bdist_wheel
        running build
        running build_py
        creating build
        creating build/lib.macosx-12-arm64-cpython-310
        creating build/lib.macosx-12-arm64-cpython-310/psycopg2
        copying lib/_json.py -> build/lib.macosx-12-arm64-cpython-310/psycopg2
        copying lib/extras.py -> build/lib.macosx-12-arm64-cpython-310/psycopg2
        copying lib/errorcodes.py -> build/lib.macosx-12-arm64-cpython-310/psycopg2
        copying lib/tz.py -> build/lib.macosx-12-arm64-cpython-310/psycopg2
        copying lib/_range.py -> build/lib.macosx-12-arm64-cpython-310/psycopg2
        copying lib/_ipaddress.py -> build/lib.macosx-12-arm64-cpython-310/psycopg2
        copying lib/__init__.py -> build/lib.macosx-12-arm64-cpython-310/psycopg2
        copying lib/extensions.py -> build/lib.macosx-12-arm64-cpython-310/psycopg2
        copying lib/errors.py -> build/lib.macosx-12-arm64-cpython-310/psycopg2
        copying lib/sql.py -> build/lib.macosx-12-arm64-cpython-310/psycopg2
        copying lib/pool.py -> build/lib.macosx-12-arm64-cpython-310/psycopg2
        running build_ext
        building 'psycopg2._psycopg' extension
        creating build/temp.macosx-12-arm64-cpython-310
        creating build/temp.macosx-12-arm64-cpython-310/psycopg
        clang -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX12.sdk "-DPSYCOPG_VERSION=2.9.3 (dt dec pq3 ext lo64)" -DPSYCOPG_DEBUG=1 -DPG_VERSION_NUM=140005 -DHAVE_LO64=1 -DPSYCOPG_DEBUG=1 -I/Users/apensia/Library/Caches/pypoetry/virtualenvs/letsh-admin-zfYQThb9-py3.10/include -I/opt/homebrew/opt/python@3.10/Frameworks/Python.framework/Versions/3.10/include/python3.10 -I. -I/opt/homebrew/include/postgresql@14 -I/opt/homebrew/include/postgresql@14/server -I/opt/homebrew/Cellar/icu4c/70.1/include -I/opt/homebrew/opt/openssl@1.1/include -I/opt/homebrew/opt/readline/include -I/opt/homebrew/Cellar/lz4/1.9.4/include -c psycopg/adapter_asis.c -o build/temp.macosx-12-arm64-cpython-310/psycopg/adapter_asis.o
        2022-09-16 15:33:49.770 xcodebuild[1607:18240] [MT] DVTPlugInLoading: Failed to load code for plug-in com.apple.dt.IDESimulatorAvailability (/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin), error = Error Domain=NSCocoaErrorDomain Code=3588 "dlopen(/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin/Contents/MacOS/IDESimulatorAvailability, 0x0109): Symbol not found: (_OBJC_CLASS_$_SimDiskImage)
          Referenced from: '/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin/Contents/MacOS/IDESimulatorAvailability'
          Expected in: '/Library/Developer/PrivateFrameworks/CoreSimulator.framework/Versions/A/CoreSimulator'" UserInfo={NSLocalizedFailureReason=The bundle couldn’t be loaded., NSLocalizedRecoverySuggestion=Try reinstalling the bundle., NSFilePath=/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin/Contents/MacOS/IDESimulatorAvailability, NSDebugDescription=dlopen(/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin/Contents/MacOS/IDESimulatorAvailability, 0x0109): Symbol not found: (_OBJC_CLASS_$_SimDiskImage)
          Referenced from: '/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin/Contents/MacOS/IDESimulatorAvailability'
          Expected in: '/Library/Developer/PrivateFrameworks/CoreSimulator.framework/Versions/A/CoreSimulator', NSBundlePath=/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin, NSLocalizedDescription=The bundle “IDESimulatorAvailability” couldn’t be loaded.}, dyldError = dlopen(/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin/Contents/MacOS/IDESimulatorAvailability, 0x0000): Symbol not found: (_OBJC_CLASS_$_SimDiskImage)
          Referenced from: '/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin/Contents/MacOS/IDESimulatorAvailability'
          Expected in: '/Library/Developer/PrivateFrameworks/CoreSimulator.framework/Versions/A/CoreSimulator'
        2022-09-16 15:33:49.792 xcodebuild[1607:18240] [MT] DVTAssertions: ASSERTION FAILURE in /System/Volumes/Data/SWE/Apps/DT/BuildRoots/BuildRoot2/ActiveBuildRoot/Library/Caches/com.apple.xbs/Sources/DVTFrameworks/DVTFrameworks-21303/DVTFoundation/PlugInArchitecture/DataModel/DVTPlugIn.m:374
        Details:  Failed to load code for plug-in com.apple.dt.IDESimulatorAvailability (/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin)
        Please ensure Xcode packages are up-to-date — try running 'xcodebuild -runFirstLaunch'.

        NSBundle error: Error Domain=NSCocoaErrorDomain Code=3588 "dlopen(/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin/Contents/MacOS/IDESimulatorAvailability, 0x0109): Symbol not found: (_OBJC_CLASS_$_SimDiskImage)
          Referenced from: '/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin/Contents/MacOS/IDESimulatorAvailability'
          Expected in: '/Library/Developer/PrivateFrameworks/CoreSimulator.framework/Versions/A/CoreSimulator'" UserInfo={NSLocalizedFailureReason=The bundle couldn’t be loaded., NSLocalizedRecoverySuggestion=Try reinstalling the bundle., NSFilePath=/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin/Contents/MacOS/IDESimulatorAvailability, NSDebugDescription=dlopen(/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin/Contents/MacOS/IDESimulatorAvailability, 0x0109): Symbol not found: (_OBJC_CLASS_$_SimDiskImage)
          Referenced from: '/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin/Contents/MacOS/IDESimulatorAvailability'
          Expected in: '/Library/Developer/PrivateFrameworks/CoreSimulator.framework/Versions/A/CoreSimulator', NSBundlePath=/Applications/Xcode.app/Contents/PlugIns/IDESimulatorAvailability.ideplugin, NSLocalizedDescription=The bundle “IDESimulatorAvailability” couldn’t be loaded.}
        Object:   <DVTPlugIn: 0x10d35bee0>
        Method:   -loadAssertingOnError:error:
        Thread:   <_NSMainThread: 0x13360c9b0>{number = 1, name = main}
        Hints:

        Backtrace:
          0  0x0000000102939410
          1  0x0000000102938aec
          2  0x0000000102938c6c
          3  0x00000001027e72ac
          4  0x00000001027ad118
          5  0x00000001027ab528
          6  0x00000001862941b4
          7  0x00000001862a3414
          8  0x000000010297d58c
          9  0x00000001029594b0
         10  0x00000001027ab3c0
         11  0x00000001027ab5e0
         12  0x000000010386f2ec
         13  0x000000010386eae0
         14  0x000000010386e1e8
         15  0x0000000101050324
         16  0x0000000101001e0c
        sh: line 1:  1609 Abort trap: 6           /Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuild -sdk /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk -find clang 2> /dev/null
        clang: error: sh -c '/Applications/Xcode.app/Contents/Developer/usr/bin/xcodebuild -sdk /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk -find clang 2> /dev/null' failed with exit code 34304: (null) (errno=Invalid argument)
        xcode-select: Failed to locate 'clang', requesting installation of command line developer tools.

        It appears you are missing some prerequisite to build the package from source.

        You may install a binary package by installing 'psycopg2-binary' from PyPI.
        If you want to install psycopg2 from source, please install the packages
        required for the build and try again.

        For further information please check the 'doc/src/install.rst' file (also at
        <https://www.psycopg.org/docs/install.html>).

        error: command '/usr/bin/clang' failed with exit code 72
        [end of output]

    note: This error originates from a subprocess, and is likely not a problem with pip.
    ERROR: Failed building wheel for psycopg2
  Failed to build psycopg2
  ERROR: Could not build wheels for psycopg2, which is required to install pyproject.toml-based projects


  at ~/.local/pipx/venvs/poetry/lib/python3.10/site-packages/poetry/utils/env.py:1473 in _run
      1469│                 output = subprocess.check_output(
      1470│                     command, stderr=subprocess.STDOUT, env=env, **kwargs
      1471│                 )
      1472│         except CalledProcessError as e:
    → 1473│             raise EnvCommandError(e, input=input_)
      1474│
      1475│         return decode(output)
      1476│
      1477│     def execute(self, bin: str, *args: str, **kwargs: Any) -> int:

The following error occurred when trying to handle this error:


  PoetryException

  Failed to install /Users/apensia/Library/Caches/pypoetry/artifacts/53/f4/10/6c4fbf8671cd3e90cb0e036883b7aa9e49359e40fa11a699ffb31b2f2e/psycopg2-2.9.3.tar.gz

  at ~/.local/pipx/venvs/poetry/lib/python3.10/site-packages/poetry/utils/pip.py:51 in pip_install
       47│
       48│     try:
       49│         return environment.run_pip(*args)
       50│     except EnvCommandError as e:
    →  51│         raise PoetryException(f"Failed to install {path.as_posix()}") from e
       52│
```

<br/>

## 문제 분석

제일 핵심적인 내용은 다음과 같이 macOS의 Command Line Tools Package 중 하나인 Clang과 관련된 문제처럼 보였다.
여기서 Command Line Tools Package는 macOS에서 명령어를 이용하여 개발을 할 수 있도록 도와주는 Xcode와 별개로 다운로드 받을 수 있는 일종의 작은 패키지이다.[^1]

`xcode-select: Failed to locate 'clang', requesting installation of command line developer tools.`

## 문제 해결

해당 문제를 다음과 같이 분석해보았다.

1. M1 칩과 호환되지 않는 경우 &rarr; 다른 패키지를 써보자
2. Command Line Developer Tools 문제의 경우

<br/>

### 시도1 &rarr; 😓 실패

콘솔에서 얘기해준대로, psycopg2를 대신할 수 있는 <a href="https://pypi.org/project/psycopg2-binary/" target="_blank">psycopg2-binary</a> 패키지를 사용해보는 것은 어떨까 생각했다.

하지만 여전히 위와 똑같은 에러가 발생하였다. 여기서 알 수 있는 점은 M1 칩과 호환이 되지 않는 것의 여부는 이 문제와 전혀 상관없어 보였다.

<br/>

### 시도2 &rarr; 😊 성공

Stack Overflow 사이트에서 <a href="https://apple.stackexchange.com/questions/415563/repeatedly-being-asked-to-install-command-line-tools/446563#446563" target="_blank">구글링해본 결과</a> 다음 명령어를 통해서 해결할 수 있었다.

`sudo xcode-select -switch /Library/Developer/CommandLineTools`

그리고 <a href="https://apple.stackexchange.com/a/446624" target="_blank">바로 아래 답글에서</a> 확인할 수 있었던 것이 M1 칩의 Monterey 12.6 버전으로 업데이트 한 이후 Xcode CLI tools 14.0 버전을 설치한 이후
문제가 발생되었다고 한다. 역시 macOS의 업데이트는 항상 날 이렇게 힘들게 한다.

~~그렇다면 여태까지 Django나 Pillow 같은 다른 패키지들은 어떻게 설치가 된 거지?~~

<br/>

## 참고 자료

[^1]:
      <a href="https://developer.apple.com/library/archive/technotes/tn2339/_index.html" target="_blank">What is the Command Line Tools Package?</a>
