# Cloudflare로 이미지 업로드하기

## 개요

유저가 본인의 프로필 사진(`avatar`)을 업로드를 할 때 우리의 서버에 직접 올리게 한다면 다음과 같은 문제점들이 발생하게 될 것이다.

1. 서버가 재시작되거나 종료를 시켜야 할 경우 유저가 올린 프로필 사진 데이터가 전부 증발한다.
2. 여러 대의 서버를 둬야 할 경우 해당 사진 파일들이 어디에 저장되었는지 일일히 찾아야 한다.

따라서 이번에는 CloudFlare Images를 사용하여 작업을 진행해보고자 한다.

> AWS S3를 쓸까도 생각했었지만 비용과 이미지 최적화 등 이미지 파일에 대한 사후처리 기능이 더욱 다양한 CloudFlare Images를 활용하기로 하였다.

## 전략

그렇다면 유저들이 올리는 프로필 사진을 저장하는 전략들을 한 번 살펴보자.

### 1번째

1번째 전략은 유저가 우리 서버에 이미지 파일을 업로드한 후 그 파일을 다시 CloudFlare Images에 재저장하는 방식이다.

하지만 이렇게 되면 업로드를 2번씩이나 거쳐야 하기 때문에 시간도 많이 걸릴 뿐더러 혹여나 유저가 크기가 큰 파일을 업로드할 경우 사용 대역폭에 따른 추가 비용이 발생할 수도 있다.

### 2번째

2번째 전략은 유저로 하여금 직접 CloudFlare Images에 이미지 파일을 업로드하는 방식이다.

1. CloudFlare Images에 이미지 파일을 올릴 수 있는 안전한 URL을 달라고 요청을 보낸다.
2. 유저는 그 안전한 URL을 통해 파일을 올린다.
3. 유저가 브라우저를 통해 파일을 업로드하면 그 즉시 CloudFlare Images에 저장이 되고, 파일이 업로드된 새로운 URL이 생기게 된다.
4. 우리 서버에서 해당 새로운 URL을 가로채서 데이터베이스에 저장한다.

## 구현

<CH.Scrollycoding>

###

</CH.Scrollycoding>
